@import "../../main/variables";

%show-dropdown {
	opacity: 1;
	visibility: visible;
}

.caret {
	transition: 0.3s ease;
}

.dd-title {
	flex-grow: var(--flexG);
	display: flex;
	align-items: center;
}


// === Desktop menu === //
.nav-ul {
	display: flex;
	flex-wrap: wrap;
	margin-right: calc(var(--spacing) / 2 * -1);
	margin-left: calc(var(--spacing) / 2 * -1);

	li > a {
		display: flex;
		align-items: center;
		min-height: var(--height);
		color: var(--color);
		position: relative;
	}

	li > a:hover {
		color: var(--hoverColor);
	}

	> li {
		margin: 0 calc(var(--spacing) / 2);
	}

	li {
		display: block;
		position: relative;

		&.current-menu-item > a:not([href*="#"]) {
			color: var(--activeColor);
		}

		&:hover > .sub-menu,
		&:focus-within > .sub-menu {

			@extend %show-dropdown;
		}
	}

	.caret {
		display: flex;
		margin-left: 5px;
		justify-content: center;

		svg {
			fill: currentColor;
			width: 0.5em;
			height: 0.5em;
		}
	}

	.sub-menu {
		background-color: var(--bgColor, var(--overlayColor));
		z-index: 100;
		position: absolute;
		top: 100%;
		box-shadow: $soft-box-shadow;
		visibility: hidden;
		opacity: 0;
		right: 0;

		li {
			min-width: 150px;
		}

		li > a {
			padding: $spacing-xs $spacing-md;
			white-space: nowrap;
			display: flex;
		}

		.sub-menu {
			left: 100%;
			top: 0;
			right: unset;
		}
	}
}

.sub-menu.dropdown-open {

	@extend %show-dropdown;
}

// === Inside Sidebar === //
.header-menu-sidebar {

	.nv-nav-wrap {
		width: 100%;
	}

	.nav-ul {
		--spacing: 0;
		flex-direction: column;
		width: 100%;

		li {
			width: 100%;
		}

		li:not([class*="block"]) > a {
			padding: $spacing-sm 0;
			white-space: unset;
		}

		.caret svg {
			width: 1em;
			height: 1em;
		}

		.caret-wrap {
			margin: -15px 0;
			padding: 15px 15px 15px 10px;

			&.dropdown-open .caret {
				transform: rotateX(180deg);
			}

		}

		.sub-menu {
			// Important because of the different open behaviours of the sidebar.
			left: unset !important;
			top: unset !important;
			right: unset !important;
			background: 0;
			position: relative;
			max-width: 100%;
			box-shadow: none;
			display: none;

			//Expanded by default vs desktop.
			@extend %show-dropdown;

			&.dropdown-open {
				display: block;
			}
		}

		&.dropdowns-expanded {

			> li > .sub-menu {
				display: block;
			}

			> li > a {

				.caret-wrap {
					display: none;
				}
			}
		}
	}

	.has-caret.amp {
		padding-right: 0;
	}

	.amp.dropdown-open + .sub-menu {
		display: block !important;
	}
}

// === AMP === //
.amp-desktop-caret-wrap {
	display: none;
}

.amp-caret-wrap {

	svg {
		fill: currentColor;
		width: 1em;
	}
}

.has-caret.amp {
	display: flex;
	align-items: center;

	.caret-wrap {
		margin-left: auto;
	}
}

.sub-menu .has-caret.amp {
	padding-right: $spacing-md;
}

@mixin nav-menu--laptop() {

	.amp-desktop-caret-wrap {
		display: none;
	}

	.amp-caret-wrap {
		display: block;
	}
}
